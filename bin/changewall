#!/usr/bin/env sh

BG_LOCATION=$XDG_CONFIG_HOME/wallpaper
WALLPAPER=""

if [ $# -eq 1 ]
then
    FULL_PATH=$(readlink -f "$1")
    # if directory
    if [ -d "$FULL_PATH" ]
    then
        # Find wallpaper and select 1 @ random
        WALLPAPER=$(find "${FULL_PATH}" -iregex '.*.\(jpg\|jpeg\|png\)' | shuf -n 1)
        # Check if WALLPAPER is not empty
        [ -z "$WALLPAPER" ] && echo "Directory no have immmmmmmage, try again" && exit
    # if file
    elif [ -f "$FULL_PATH" ]
    then
        case $(file --mime-type -b "$FULL_PATH") in
            image/*)
                WALLPAPER="$FULL_PATH"
                ;;
            *)
                notify-send "üñºÔ∏è Error" "Not a valid image or directory."
                ;;
        esac
    # If doesn't exist
    else
        echo "Does not exist" && return
    fi
fi

if [ -n "$WALLPAPER" ]
then
    ln -sf "$WALLPAPER" "$BG_LOCATION"
fi
echo "$WALLPAPER"

setwall
